<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agri-Connect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E5C3E 0%, #4A7856 100%);
            min-height: 100vh;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 248, 235, 0.98);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(46, 92, 62, 0.2);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid #C49A6C;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2E5C3E;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo span {
            background: #E6B17E;
            color: #2E5C3E;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: normal;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #2E5C3E;
            font-weight: 600;
            transition: color 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #C49A6C;
            background: rgba(46, 92, 62, 0.1);
        }

        .language-selector {
            padding: 0.5rem 1rem;
            border-radius: 25px;
            border: 2px solid #C49A6C;
            background: #FFF8EB;
            color: #2E5C3E;
            font-weight: 600;
            outline: none;
            cursor: pointer;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 100px auto 2rem;
            padding: 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            color: #FFF8EB;
            padding: 4rem 2rem;
            background: rgba(198, 153, 107, 0.2);
            border-radius: 40px;
            backdrop-filter: blur(10px);
            margin-bottom: 3rem;
            border: 2px solid #E6B17E;
            box-shadow: 0 20px 40px rgba(46, 92, 62, 0.3);
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            color: #FFE9D0;
        }

        /* Statistics Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: #FFF8EB;
            padding: 2rem;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(46, 92, 62, 0.2);
            border: 2px solid #C49A6C;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-10px);
            background: #E6B17E;
            border-color: #2E5C3E;
        }

        .stat-card:hover .stat-number {
            color: #2E5C3E;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #C49A6C;
            transition: color 0.3s;
        }

        .stat-label {
            color: #2E5C3E;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Dashboard - now used as page container */
        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-top: 2rem;
        }

        /* Panels (pages) */
        .panel {
            background: #FFF8EB;
            border-radius: 40px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(46, 92, 62, 0.3);
            width: 100%;
        }

        .panel h2 {
            color: #2E5C3E;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.8rem;
            border-bottom: 3px solid #C49A6C;
            padding-bottom: 0.8rem;
        }

        .farmer-panel {
            border: 3px solid #E6B17E;
            background: linear-gradient(135deg, #FFF8EB 0%, #F5E6D3 100%);
        }

        .farmer-panel h2 {
            color: #8B5A2B;
        }

        .consumer-panel {
            border: 3px solid #2E5C3E;
            background: linear-gradient(135deg, #F0F7E6 0%, #E0EBD3 100%);
        }

        .consumer-panel h2 {
            color: #2E5C3E;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #5C3E2E;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.9rem 1rem;
            border: 2px solid #E6B17E;
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            color: #2E5C3E;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2E5C3E;
            box-shadow: 0 0 0 4px rgba(46, 92, 62, 0.1);
        }

        .btn {
            background: #2E5C3E;
            color: #FFF8EB;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            border: 2px solid #C49A6C;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: #C49A6C;
            color: #2E5C3E;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(46, 92, 62, 0.3);
            border-color: #2E5C3E;
        }

        .btn-secondary {
            background: #E6B17E;
            color: #2E5C3E;
            border-color: #2E5C3E;
        }

        .btn-secondary:hover {
            background: #FFF8EB;
        }

        /* Price Prediction Card */
        .prediction-card {
            background: #FFF8EB;
            border-radius: 25px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 3px solid #E6B17E;
            box-shadow: 0 5px 20px rgba(198, 153, 107, 0.2);
        }

        .prediction-card h3 {
            color: #8B5A2B;
            font-size: 1.4rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-range {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1rem 0;
            padding: 0.5rem;
            background: rgba(230, 177, 126, 0.1);
            border-radius: 15px;
        }

        .price-badge {
            background: #2E5C3E;
            color: #FFF8EB;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid #E6B17E;
        }

        /* Product Cards */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
            max-height: 500px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .product-card {
            background: white;
            border-radius: 25px;
            padding: 1.5rem;
            transition: all 0.3s;
            border: 2px solid #E6B17E;
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: "üå±";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            opacity: 0.1;
        }

        .product-card:hover {
            transform: translateY(-5px);
            border-color: #2E5C3E;
            box-shadow: 0 15px 35px rgba(46, 92, 62, 0.2);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .farmer-name {
            color: #2E5C3E;
            font-weight: 700;
            font-size: 1.2rem;
            background: rgba(230, 177, 126, 0.2);
            padding: 0.3rem 1rem;
            border-radius: 50px;
        }

        .region-tag {
            background: #C49A6C;
            color: #FFF8EB;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .product-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: #8B5A2B;
            margin: 0.5rem 0;
        }

        .consumer-price {
            color: #2E5C3E;
            font-size: 0.9rem;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .savings-badge {
            background: #2E5C3E;
            color: #FFF8EB;
            padding: 0.3rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
            margin: 0.5rem 0;
        }

        .order-btn {
            background: #C49A6C;
            color: #2E5C3E;
            padding: 0.8rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .order-btn:hover {
            background: #2E5C3E;
            color: #FFF8EB;
            border-color: #C49A6C;
        }

        /* Cart Section */
        .cart-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #FFF8EB;
            border-radius: 25px;
            border: 3px solid #2E5C3E;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            border-bottom: 2px solid #E6B17E;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 3px dashed #C49A6C;
            font-size: 1.3rem;
            font-weight: bold;
            color: #2E5C3E;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 90px;
            right: 20px;
            background: #2E5C3E;
            color: #FFF8EB;
            padding: 1rem 2rem;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(46, 92, 62, 0.3);
            border-left: 5px solid #E6B17E;
            z-index: 1500;
            animation: slideIn 0.3s ease;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Farmer Notification Area */
        .farmer-notifications {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #FFF8EB;
            border-radius: 25px;
            border: 2px solid #E6B17E;
        }

        .farmer-notifications h3 {
            color: #8B5A2B;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-item {
            background: rgba(230, 177, 126, 0.1);
            padding: 1rem;
            border-radius: 15px;
            margin-bottom: 0.5rem;
            border-left: 4px solid #2E5C3E;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(46, 92, 62, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #FFF8EB;
            padding: 3rem;
            border-radius: 50px;
            max-width: 500px;
            width: 90%;
            border: 4px solid #E6B17E;
            text-align: center;
        }

        .modal-content h2 {
            color: #2E5C3E;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .modal-content p {
            color: #5C3E2E;
            margin: 1rem 0;
            line-height: 1.6;
        }

        /* Page visibility */
        .page {
            display: none;
        }
        .page.active-page {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #F5E6D3;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #C49A6C;
            border-radius: 10px;
            border: 2px solid #2E5C3E;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2E5C3E;
        }

        /* Farmer Badge */
        .farmer-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #E6B17E;
            color: #2E5C3E;
            padding: 0.3rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Product Meta */
        .product-meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 0.8rem 0;
        }

        .meta-tag {
            background: #F5E6D3;
            color: #8B5A2B;
            padding: 0.2rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            üåæ Agri-Connect
            <span>Bridge From Farmer - Consumer</span>
        </div>
        <div class="nav-links">
            <!-- Page switcher buttons -->
            <a id="navFarmer" class="active">üë®‚Äçüåæ Farmer's Panel</a>
            <a id="navConsumer">üõí Consumer Panel</a>
            <select class="language-selector" id="languageSelector">
                <option value="en">English</option>
                <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
            </select>
        </div>
    </nav>

    <!-- Main Container (holds both pages) -->
    <div class="container">
        <!-- Farmer Page (visible by default) -->
        <div id="farmerPage" class="page active-page">
            <!-- Farmer Panel (full) -->
            <div class="panel farmer-panel" id="farmerPanel">
                <h2>üë®‚Äçüåæ Farmer's Panel</h2> 
                
                <form id="farmerForm">
                    <div class="form-group">
                        <label>Farmer's Name</label>
                        <input type="text" id="farmerName" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label>National Identity Card Number</label>
                        <input type="text" id="NIC" placeholder="Enter NIC number" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Farming Region</label>
                        <select id="region" required>
                            <option value="">Select your region</option>
                            <option value="north">Anuradhapura</option>
                            <option value="south">Polonnaruwa</option>
                            <option value="east">Ampara</option>
                            <option value="west">Hambantota</option>
                            <option value="central">Nuwara Eliya</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Crop Type</label>
                        <select id="cropType" required>
                            <option value="">Select your crop</option>
                            <option value="vegetables">Fresh Vegetables</option>
                            <option value="fruits">Seasonal Fruits</option>
                            <option value="grains">Grains & Pulses</option>
                            <option value="spices">Organic Spices</option>
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Seed Cost (LKR)</label>
                            <input type="number" id="seedCost" placeholder="Cost" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Fertilizer Cost (LKR)</label>
                            <input type="number" id="fertilizerCost" placeholder="Cost" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Labor Cost (LKR)</label>
                            <input type="number" id="laborCost" placeholder="Cost" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Water/Irrigation (LKR)</label>
                            <input type="number" id="waterCost" placeholder="Cost" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Transport Cost (LKR)</label>
                            <input type="number" id="transportCost" placeholder="Cost" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Quantity (kg)</label>
                            <input type="number" id="quantity" placeholder="in kg" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn">Calculate Price</button>
                </form>

                <!-- Prediction Result -->
                <div id="predictionResult" style="display: none;" class="prediction-card">
                    <h3>üìä Your Fair Price Analysis</h3>
                    <div class="prediction-range">
                        <span>Your Total Investment:</span>
                        <span class="price-badge" id="costPrice">LKR 0/kg</span>
                    </div>
                    <div class="prediction-range">
                        <span>Market Consumer Price:</span>
                        <span class="price-badge" id="consumerPrice">LKR 0/kg</span>
                    </div>
                    <div class="prediction-range" style="background: #2E5C3E; color: #FFF8EB;">
                        <span>Your Fair Selling Price:</span>
                        <span class="price-badge" style="background: #E6B17E; color: #2E5C3E;" id="recommendedPrice">LKR 0/kg</span>
                    </div>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: #5C3E2E;">
                        üå± Based on your costs, seasonal demand, and market analysis
                    </p>
                    <button class="btn btn-secondary" id="listProductBtn" style="margin-top: 1rem;">
                        üåü List Your Harvest for Sale
                    </button>
                </div>

                <!-- Farmer Notifications -->
                <div class="farmer-notifications">
                    <div id="notificationList" style="max-height: 200px; overflow-y: auto;">
                        <!-- Notifications will appear here -->
                    </div>
                </div>
            </div>
        </div> <!-- end farmerPage -->

        <!-- Consumer Page (hidden by default) -->
        <div id="consumerPage" class="page">
             <section class="hero">
                <h1>Our Small efforts, Tomorrows Harvest</h1>
                <p>Here after No Middlemen Cost You can directly buy from the farmers and also farmers can directly sell to the consumers. We are here to connect the farmers and consumers together.</p>
            </section>
            <div class="panel consumer-panel" style="margin-top: 1rem;">
                <h2>üõí Fresh Market</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="form-group">
                        <label>Filter by Region</label>
                        <select id="consumerRegion" onchange="filterProducts()">
                            <option value="all">All Farming Regions</option>
                            <option value="north">Anuradhapura</option>
                            <option value="south">Polonnaruwa</option>
                            <option value="east">Ampara</option>
                            <option value="west">Hambantota</option>
                            <option value="central">Nuwara Eliya</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Filter by Produce</label>
                        <select id="consumerCrop" onchange="filterProducts()">
                            <option value="all">All Fresh Produce</option>
                            <option value="vegetables">ü•ï Vegetables</option>
                            <option value="fruits">üçé Fruits</option>
                            <option value="grains">üåæ Grains</option>
                            <option value="spices">üå∂Ô∏è Spices</option>
                        </select>
                    </div>
                </div>

                <!-- Product Grid -->
                <div id="productGrid" class="product-grid">
                    <!-- Products will be dynamically added here -->
                </div>

                <!-- Cart Summary -->
                <div class="cart-section">
                    <h3 style="color: #2E5C3E; margin-bottom: 1rem;">üõçÔ∏è Your Basket</h3>
                    <div id="cartItems"></div>
                    <div class="cart-total">
                        <span>Total Amount:</span>
                        <span class="price-badge" id="cartTotal">0</span>
                    </div>
                    <button class="btn" id="checkoutBtn" style="margin-top: 1rem;" onclick="checkout()">
                        ‚úÖ Place Order & Support Farmers
                    </button>
                </div>
            </div>
        </div> <!-- end consumerPage -->
    </div>

    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <h2>üåæ Order Confirmed!</h2>
            <p>Thank you for supporting our farmers! Your fresh produce will reach you soon.</p>
            <p id="orderSummary" style="background: #F5E6D3; padding: 1rem; border-radius: 15px; margin: 1rem 0;"></p>
            <p style="color: #2E5C3E;">üå± Direct from farm to your table - No middlemen!</p>
            <button class="btn" onclick="closeModal()">Check out</button>
        </div>
    </div>

    <script>
        // Language translations (placeholder)
        const translations = {
            en: { welcome: "From Our Fields to Your Table" },
            ta: { welcome: "‡Æé‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡ÆØ‡Æ≤‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Øá‡Æö‡Øà‡Æï‡Øç‡Æï‡ØÅ" }
        };

        // ---------- State ----------
        let products = [];
        let cart = [];
        let farmerNotifications = [];
        let farmerId = 1;

        // ---------- Page Switching ----------
        const farmerPage = document.getElementById('farmerPage');
        const consumerPage = document.getElementById('consumerPage');
        const navFarmer = document.getElementById('navFarmer');
        const navConsumer = document.getElementById('navConsumer');

        navFarmer.addEventListener('click', () => {
            farmerPage.classList.add('active-page');
            consumerPage.classList.remove('active-page');
            navFarmer.classList.add('active');
            navConsumer.classList.remove('active');
        });

        navConsumer.addEventListener('click', () => {
            consumerPage.classList.add('active-page');
            farmerPage.classList.remove('active-page');
            navConsumer.classList.add('active');
            navFarmer.classList.remove('active');
            // refresh product grid when switching to consumer page
            updateProductGrid();
        });

        // Language selector
        document.getElementById('languageSelector').addEventListener('change', function(e) {
            const lang = e.target.value;
            showNotification(`üåæ Language changed to ${lang === 'ta' ? '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç' : 'English'}`);
        });

        // ---------- Farmer form submission ----------
        document.getElementById('farmerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const farmerData = {
                farmerName: document.getElementById('farmerName').value,
                region: document.getElementById('region').value,
                cropType: document.getElementById('cropType').value,
                seedCost: parseFloat(document.getElementById('seedCost').value) || 0,
                fertilizerCost: parseFloat(document.getElementById('fertilizerCost').value) || 0,
                laborCost: parseFloat(document.getElementById('laborCost').value) || 0,
                waterCost: parseFloat(document.getElementById('waterCost').value) || 0,
                transportCost: parseFloat(document.getElementById('transportCost').value) || 0,
                quantity: parseFloat(document.getElementById('quantity').value) || 1
            };

            const totalCost = farmerData.seedCost + farmerData.fertilizerCost + 
                            farmerData.laborCost + farmerData.waterCost + farmerData.transportCost;
            
            const costPerKg = totalCost / farmerData.quantity;
            
            const seasonalFactor = getSeasonalFactor(farmerData.region);
            const demandFactor = getDemandFactor(farmerData.cropType);
            const weatherImpact = getWeatherImpact(farmerData.region);
            
            const predictedPrice = costPerKg * (1.3 + seasonalFactor + demandFactor + weatherImpact);
            const recommendedPrice = predictedPrice * 0.85;

            document.getElementById('costPrice').textContent = `LKR${costPerKg.toFixed(2)}/kg`;
            document.getElementById('consumerPrice').textContent = `LKR${predictedPrice.toFixed(2)}/kg`;
            document.getElementById('recommendedPrice').textContent = `LKR${recommendedPrice.toFixed(2)}/kg`;
            
            document.getElementById('predictionResult').style.display = 'block';

            window.currentFarmerData = {
                ...farmerData,
                costPerKg,
                predictedPrice,
                recommendedPrice,
                farmerId: `FARM${String(farmerId++).padStart(3, '0')}`,
                listingDate: new Date().toISOString()
            };

            showNotification('üå± Price calculated successfully!');
        });

        // Helper factors
        function getSeasonalFactor(region) {
            const factors = { north:0.12, south:0.18, east:0.08, west:0.15, central:0.10 };
            return factors[region] || 0.12;
        }
        function getDemandFactor(cropType) {
            const factors = { vegetables:0.25, fruits:0.22, grains:0.15, spices:0.30 };
            return factors[cropType] || 0.20;
        }
        function getWeatherImpact(region) {
            const impacts = { north:0.06, south:0.10, east:0.04, west:0.08, central:0.05 };
            return impacts[region] || 0.06;
        }

        // ---------- List product (appears in consumer panel) ----------
        document.getElementById('listProductBtn').addEventListener('click', function() {
            if (window.currentFarmerData) {
                const product = {
                    id: `PROD${Date.now()}`,
                    farmerName: window.currentFarmerData.farmerName,
                    farmerId: window.currentFarmerData.farmerId,
                    region: window.currentFarmerData.region,
                    cropType: window.currentFarmerData.cropType,
                    price: window.currentFarmerData.recommendedPrice,
                    originalPrice: window.currentFarmerData.predictedPrice,
                    quantity: window.currentFarmerData.quantity,
                    listingDate: window.currentFarmerData.listingDate,
                    savings: (window.currentFarmerData.predictedPrice - window.currentFarmerData.recommendedPrice).toFixed(2)
                };
                
                products.push(product);
                updateProductGrid(); // updates consumer grid
                
                document.getElementById('farmerForm').reset();
                document.getElementById('predictionResult').style.display = 'none';
                
                showNotification('‚úÖ Your harvest is now listed for sale in Fresh Market!');
                
                // Update farmer stats
                document.getElementById('activeFarmers').textContent = products.length + 248;
            } else {
                showNotification('Please calculate price first before listing!');
            }
        });

        // ---------- Product grid & filtering ----------
        function updateProductGrid() {
            const grid = document.getElementById('productGrid');
            const regionFilter = document.getElementById('consumerRegion').value;
            const cropFilter = document.getElementById('consumerCrop').value;
            
            let filteredProducts = products;
            
            if (regionFilter !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.region === regionFilter);
            }
            if (cropFilter !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.cropType === cropFilter);
            }
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 3rem; color: #5C3E2E;">üå± No fresh produce listed yet. Check back soon!</div>';
                return;
            }
            
            const regionNames = { north:'Anuradhapura', south:'Polonnaruwa', east:'Ampara', west:'Hambantota', central:'Nuwara Eliya' };
            const cropIcons = { vegetables:'ü•ï', fruits:'üçé', grains:'üåæ', spices:'üå∂Ô∏è' };
            
            grid.innerHTML = filteredProducts.map(product => {
                return `
                <div class="product-card">
                    <div class="product-header">
                        <span class="farmer-name">${product.farmerName}</span>
                        <span class="region-tag">${regionNames[product.region]}</span>
                    </div>
                    <div class="product-meta">
                        <span class="meta-tag">${cropIcons[product.cropType]} ${product.cropType}</span>
                        <span class="meta-tag">ID: ${product.farmerId}</span>
                    </div>
                    <div class="product-price">LKR${product.price.toFixed(2)}/kg</div>
                    <div class="consumer-price">Market Price: LKR${product.originalPrice.toFixed(2)}/kg</div>
                    <span class="savings-badge">You Save: LKR${product.savings}/kg</span>
                    <div style="font-size: 0.9rem; color: #2E5C3E; margin: 0.5rem 0;">
                        üå± Available: ${product.quantity} kg fresh stock
                    </div>
                    <button class="order-btn" onclick="addToCart('${product.id}')">
                        üõí Add to Basket
                    </button>
                </div>
            `}).join('');
        }

        window.filterProducts = function() {
            updateProductGrid();
        };

        // ---------- Cart functions ----------
        window.addToCart = function(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const cartItem = cart.find(item => item.id === productId);
                if (cartItem) {
                    cartItem.quantity += 1;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                updateCart();
                showNotification('üåæ Added to your basket!');
            }
        };

        function updateCart() {
            const cartDiv = document.getElementById('cartItems');
            const totalSpan = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartDiv.innerHTML = '<p style="color: #5C3E2E; text-align: center;">Your basket is empty. Add some fresh produce!</p>';
                totalSpan.textContent = 'LKR 0';
                return;
            }
            
            let total = 0;
            cartDiv.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                return `
                    <div class="cart-item">
                        <div>
                            <span style="font-weight: 600;">${item.farmerName}</span>
                            <span style="color: #8B5A2B;"> - ${item.cropType}</span>
                        </div>
                        <div>
                            <span>${item.quantity}kg √ó LKR${item.price.toFixed(2)}</span>
                            <span style="font-weight: 600; margin-left: 1rem;">= LKR${itemTotal.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            totalSpan.textContent = `LKR${total.toFixed(2)}`;
        }

        // ---------- Checkout ----------
        window.checkout = function() {
            if (cart.length === 0) {
                showNotification('Please add items to your basket first!');
                return;
            }
            
            let orderSummary = '';
            let totalAmount = 0;
            cart.forEach(item => {
                orderSummary += `${item.farmerName} - ${item.cropType}: ${item.quantity}kg\n`;
                totalAmount += item.price * item.quantity;
                
                addFarmerNotification({
                    farmerId: item.farmerId,
                    farmerName: item.farmerName,
                    cropType: item.cropType,
                    quantity: item.quantity,
                    amount: (item.price * item.quantity).toFixed(2),
                    orderTime: new Date().toLocaleString()
                });
            });
            
            orderSummary += `\nTotal Amount: LKR${totalAmount.toFixed(2)}`;
            document.getElementById('orderSummary').textContent = orderSummary;
            document.getElementById('checkoutModal').classList.add('active');
            
            cart = [];
            updateCart();
            
            // Update stats
            document.getElementById('totalOrders').textContent = 
                parseInt(document.getElementById('totalOrders').textContent.replace(/,/g, '')) + 1;
            document.getElementById('activeConsumers').textContent = 
                parseInt(document.getElementById('activeConsumers').textContent.replace(/,/g, '')) + 1;
            
            showNotification('üéâ Order placed successfully! Thank you for supporting farmers!');
        };

        // Farmer notifications
        function addFarmerNotification(order) {
            farmerNotifications.unshift(order);
            updateFarmerNotifications();
        }

        function updateFarmerNotifications() {
            const notificationList = document.getElementById('notificationList');
            if (farmerNotifications.length === 0) {
                notificationList.innerHTML = '<p style="color: #5C3E2E; text-align: center;">No new orders yet</p>';
                return;
            }
            notificationList.innerHTML = farmerNotifications.map(notification => `
                <div class="notification-item">
                    <strong>${notification.farmerName}</strong> sold ${notification.quantity}kg ${notification.cropType}<br>
                    <small>LKR${notification.amount} ‚Ä¢ ${notification.orderTime}</small>
                </div>
            `).join('');
        }

        // Modal
        window.closeModal = function() {
            document.getElementById('checkoutModal').classList.remove('active');
        };

        // Notification helper
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => { notification.remove(); }, 3000);
        }

        // Initialize with sample data
        function initializeSampleData() {
            products = [
            ];
            updateProductGrid();
        }

        initializeSampleData();

        // sample notification
        setTimeout(() => {
        }, 2000);
    </script>
</body>
</html>